---
title: "Cyclistic_Full_Analysis"
author: "Solomon Opi"
date: "2023-09-20"
output: 
html_document:
  fig_caption: yes
  theme: cerulean
  toc: yes
  toc_depth: 3
  toc_float: yes
---
# OverView

Cyclistics is a bike share company located in Chicago with an ambition to increase its market share by maximizing the potential of its client base. The bike-share program features more than 5,800 bicycles and 600 docking stations. Cyclistic sets itself apart by also offering reclining bikes, hand tricycles, and cargo bikes, making bike-share more inclusive to people with disabilities and riders who can’t use a standard two-wheeled bike. The majority of riders opt for traditional bikes; about 8% of riders use the assistive options. Cyclistic users are more likely to ride for leisure, but about 30% use them to commute to work each day.

## Business Task

Until now, Cyclistic’s marketing strategy relied on building general awareness and appealing to broad consumer segments.Customers who purchase single-ride or full-day passes are referred to as casual riders. Customers who purchase annual memberships are Cyclistic members
The business task is therefore to analyze the differences between annual members and casual riders with the aim of converting casual riders to annual subscribers. The analysis therefore identifies the trends, and the bottlenecks and uses the results to optimize what will work for the company going forward. The analysis concludes by presenting key recommendations to stakeholders to increase company growth.

## The Analysis

Since we're using R, tet us install and load the relevant packages and set the directory to store the necessary files.

```{r}
library(tidyverse)
library(tidyverse)
library(lubridate)
library(ggplot2)
library(dplyr)
library(skimr)
```
```{r}
setwd("C:/Users/opiso/Desktop/All Data")
getwd()
```

## Data Sources

The data is first-hand internal data obtained from the company database and holds cyclist details from all stations for 12 months. The data was structured and organized in tabular form i.e., rows and columns identified by ride_id, ride type, start and end time, start and end station, and membership status. There were no issues with bias in the data. The data was also reliable, original, current, and comprehensive in answering the question. As the data is for a fictional company, data privacy, and anonymization weren’t particularly ensured because personally identifiable information was not used. 
Nevertheless, the [license](https://divvybikes.com/data-license-agreement)was issued to use the data issued by Motivate International Inc.  Data constraints were numerous particularly in regard to mandatory fields as some rows were missing crucial information such as start or end station. Since the data was not essentially complete some rows with missing data had to be omitted in the processing phase. For the most part, however, the data was well-aligned and relevant for solving the business problem. There were 12 different CSV files that were bound into one file for better analysis.

```{r}
df1 <- read.csv("C:/Users/opiso/Desktop/All Data/202006-divvy-tripdata.csv")
df2 <- read.csv("C:/Users/opiso/Desktop/All Data/202007-divvy-tripdata.csv")
df3 <- read.csv("C:/Users/opiso/Desktop/All Data/202008-divvy-tripdata.csv")
df4 <- read.csv("C:/Users/opiso/Desktop/All Data/202009-divvy-tripdata.csv")
df5 <- read.csv("C:/Users/opiso/Desktop/All Data/202010-divvy-tripdata.csv")
df6 <- read.csv("C:/Users/opiso/Desktop/All Data/202011-divvy-tripdata.csv")
df7 <- read.csv("C:/Users/opiso/Desktop/All Data/202012-divvy-tripdata.csv")
df8 <- read.csv("C:/Users/opiso/Desktop/All Data/202101-divvy-tripdata.csv")
df9 <- read.csv("C:/Users/opiso/Desktop/All Data/202102-divvy-tripdata.csv")
df10 <- read.csv("C:/Users/opiso/Desktop/All Data/202103-divvy-tripdata.csv")
df11 <- read.csv("C:/Users/opiso/Desktop/All Data/202104-divvy-tripdata.csv")
df12 <- read.csv("C:/Users/opiso/Desktop/All Data/202105-divvy-tripdata.csv")
```
```{r}
all_trips <- rbind(df1,df2,df3,df4,df5,df6,df7,df8,df9,df10,df11,df12)
View(all_trips)
str(all_trips)
```

## Cleaning and Manipulation

In order to ensure integrity, the data is checked for duplicates, typos, and nulls, and data seemed complete. We first inspect the data set to identify issues that needed fixing.
```{r}
colnames(all_trips)
nrow(all_trips)
summary(all_trips)
```

### Manipulation of data

Data on the latitude and longitude are deemed irrelevant as per the intended analytical question and were omitted. The remaing columns are key to generating needed descriptive information.

```{r}
all_trips <- all_trips %>% 
  select(-c(start_lat,start_lng,end_lat,end_lng))
```

The data can only be aggregated at the ride-level, which is too granular. We will want to add some additional columns of data such as day, month, year and day of the week that provide additional opportunities to aggregate the ridership data. 

```{r}
all_trips$date <- as.Date(all_trips$started_at)
all_trips$month <- format(as.Date(all_trips$date), "%m")
all_trips$day <- format(as.Date(all_trips$date), "%d")
all_trips$year <- format(as.Date(all_trips$date), "%Y")
all_trips$day_of_week <- format(as.Date(all_trips$date), "%A")
```

In order to determine the duration a client took per bike rides, a ride length column is calculated subtracting end_time and start_time. The results are in seconds, which can then inform how many minutes each ride lasted either between a casual rider and an annual member.
```{r}
all_trips$ride_length <- difftime(all_trips$ended_at,all_trips$started_at)
```

After creating the new column, its data type cannot be effectively used as is for analysis. Since the data type of the new ride length column created is in factor, it is important to convert it to a numeric data type for a more convenient analysis.

```{r}
is.factor(all_trips$ride_length)
all_trips$ride_length <- as.numeric(as.character(all_trips$ride_length))
is.numeric(all_trips$ride_length)
```

Now that the **dirty** data has been removed, we need to create a duplicate file. It is essential as a backup before futher descriptive analysis such that the original file remains as original as possible in case it will be needed as a reference for future analysis. 

```{r}
all_trips_v2 <- all_trips[!(all_trips$start_station_name == "HQ QR" | all_trips$ride_length<0),]
```

## Decriptive Analysis

Cyclistic executive team are notoriously detail-oriented and will need to decide whether to approve the recommended marketing program. It is therefore important to establish crucial insights. That said, the key questions guiding the analysis are:

1. What is the overall distribution of users?  
2. What is the average number of bike trips per user category? **mean**
3. What is the most common bike trip length? **median**
4. What is the range of bike trip lengths?i.e., **range** the largest      and smallest ride lengths. 
5. Are there any trends in the bike trip data over time:	
    * Most and least popular docking stations per user status,
    * The most popular usage time i,e.,rush-hour,days, seasons etc.

### The overall distribution of users:

```{r}
all_trips_v2 %>%
  group_by(member_casual) %>%
  summarize(count = length(member_casual), '%Rides' = (length(member_casual) / nrow(all_trips_v2)) * 100 )
```
```{r}
all_trips %>%
  ggplot(aes(member_casual, fill = member_casual)) + 
  geom_bar() + labs(x= "User Type", y= "No of rides", 
                    title = "Ride distribution by user type")
```

Between 31st June 2020 and May 31 2021, the data shows that there are  1,710,144 casual riders and 2,353,041 annual subscribers. The overal distribution reveals that members account for 57.9% of overal bike rides while casual riders account for 42.1%. It would be pivotal to determine how they utilized Cyclistic's bikes. The basic measures of central tendencies for each user category are analysed below:

```{r}
summary(all_trips_v2$ride_length)
```
```{r}
aggregate(all_trips_v2$ride_length ~ all_trips_v2$member_casual, FUN = mean)
aggregate(all_trips_v2$ride_length ~ all_trips_v2$member_casual, FUN = median)
aggregate(all_trips_v2$ride_length ~ all_trips_v2$member_casual, FUN = max)
aggregate(all_trips_v2$ride_length ~ all_trips_v2$member_casual, FUN = min)

```

The average ride length for both annual subscribers and casual riders was 20 minutes. Casual members showed greater variability from the average ride length, registering an average of 29 minutes while annual subscribers registered a lower average ride length of 14 minutes. Consequently, the longest recorded trip was 155 minutes, equaled by both user types coincidentally. 

### Ride distribution by user type and day of week

```{r}
all_trips_v2 %>% 
  mutate(weekday = wday(started_at, label = TRUE)) %>%  
  group_by(member_casual, weekday) %>%  
  summarise(no_of_rides = n()						
            ,average_duration = mean(ride_length)) %>% 		
  arrange(member_casual, weekday)
```
```{r}
all_trips_v2 %>%
  group_by(member_casual, day_of_week)%>%
  summarise(number_of_ride = n(),
            .groups = "drop")%>%
  ggplot(aes(day_of_week, number_of_ride, fill = member_casual)) +
  geom_col(position = "dodge") +
  labs(title = "The number of rides by Weekday", 
       x = "Weekday", y = "Number of rides")
```

It is observed that most casual users opt to ride on Saturday recording 386,813 rides with an average of 31 minute trip duration.Interestingly Sunday has 321,616 rides with an average trip duration of 33 minutes for casuals as well. Likewise, annual subscribers prefer Sunday's as well, registering 307,107 rides with an average ride time of 16 minutes. For casual riders, it can be seen that the opening days of the week,Tuesdays and Wednesday's are reserved for other transport means since they register the lowest bike use across the year compared to annual members at 38 mins. For annual members Tuesdays are Thursdays are their less busiest days across the week registering an average 14 mins in both days. Overall however, casual riders rode for longer periods.

### Ride distribution by time of day

```{r}
all_trips_v2 %>% 
  mutate(hour = hour(started_at)) %>%
  group_by(member_casual, hour) %>%
  summarise(no_of_rides = n(),
            .groups = "drop") %>%
  ggplot(aes(hour, no_of_rides, color = member_casual)) +
  geom_line() +
  geom_point() +
  scale_y_continuous(labels = scales::label_number_si(),
                     breaks = seq(0, 300000, 25000)) +
  scale_x_continuous(breaks = seq(0, 23, 1)) +
  labs(title = "Number of rides by hour of the day", 
       x = "Hour of day", y = "No of rides")
```

As evidenced by the chart above, bike use usually peaks at rush hour times, between 3pm to 7pm. The trend is observed for both casul riders and casual members. Despite this, as observed from the line graph, the number of rides by annual members is higher by nearly 100,000 more riders.

### Ride distribution by Month

A closer look at the ride distribution by month shows that June, July and Aug are the months with most rides both casuals and annual members. There could be numerous reasons for the upward trend, perhaps, an influx of tourists and visitors during summer. It is also evident that the opposite is true for January and December, as they represent the least busiest months due to the winter period. In the busy months however, it is evident that the number of casual riders are significantly more than for annual subscribers. 

```{r}
all_trips_v2 %>% 
  group_by(member_casual, month) %>%
  summarize(mean = mean(ride_length),
            .groups = "drop") %>%
  ggplot(aes(month, mean, fill = member_casual)) +
  geom_col(position = "dodge") +
  scale_y_continuous(breaks = seq(0, 28, 2)) +
  labs(title = "The average ride length by month", 
       x = "Month", y = "Average (min)")
```

### Bike and user analysis

The marketing value of the company is that it offers a range of products to make bike-share more inclusive to people with disabilities and riders who can’t use a standard two-wheeled bike. Cyclistic sets itself apart by offering classic, docked and electric bikes. From the analysis, it is observed that docked bikes are the most utilized bikes,accouting for 57.38% of bike use, used 2,331,368 times, far outpacing the other two bike categories. The classic bike was accounts for 20.76%, used 843,579 times and electric bikes used 888,278 times at 21.86%. 

```{r}
all_trips_v2 %>% 
  group_by(rideable_type) %>%
  summarise(number_of_rides = n())
```
```{r}
all_trips_v2 %>% 
  group_by(rideable_type) %>%
  summarise(number_of_rides = n()) %>%
  ggplot(aes(rideable_type, number_of_rides, fill = rideable_type)) +
  geom_col(position = "dodge", show.legend = FALSE) +
  scale_y_continuous(labels = scales::label_number_si(),
                     breaks = seq(0, 3000000, 1000000)) +
  labs(title = "Utilization of bikes", 
       x = "Rideable type",
       y = "Bike usage")
```

The data further reveals that the annual members utilized the bikes more than their casual counterparts across all the rideable bike types. The data is aggregated across all the months between June 2020 and May 2021. The docked bike had a total of 1,071,021 casual rides and 1,260,347 rides by annual members. Compared to 514,641 electric rides by annual members and 373,637 by casuals. The classic bike appears to be the least used rideable bike type with 265,526 rides by casuals and 578,053 by members.

```{r}
all_trips_v2 %>% 
  group_by(member_casual, rideable_type) %>%
  summarise(number_of_rides = n(),
            .groups = "drop") %>%
  arrange(rideable_type)
```
```{r}
all_trips_v2 %>% 
  group_by(member_casual, rideable_type) %>%
  summarise(number_of_rides = n(),
            .groups = "drop") %>%
  ggplot(aes(member_casual, number_of_rides, fill = rideable_type)) +
  geom_col(position = "dodge") +
  labs(title = "Bike usages by member status", 
       x = "Member Status", 
       y = "Bike usages")
```

In addition to being the most used rideable bike type, the docked bike also recorded the highest average trip duration across the bike categories. The average trip duration by all riders for the docked rideable type was 33 minutes, 20 minutes for the classic bike and 16 minutes for the electric rideable type.

```{r}
# bike type and average ride length
all_trips_v2 %>% 
  group_by(rideable_type) %>%
  summarise(mean = mean(ride_length),
            .groups = "drop") %>%
  arrange(rideable_type)
```
```{r}
all_trips_v2 %>% 
  group_by(rideable_type) %>%
  summarise(mean = mean(ride_length),
            .groups = "drop") %>%
  ggplot(aes(rideable_type, mean)) +
  geom_col(position = "dodge") +
  labs(title = "Average ride length by bike type",
       y = "Average ride length",
       x = "Bike Type")
```

Moreover, it comes as no surprise that casual riders utilize the bikes more than annual subscribers in all bike categories. The mean ride time for the classic bike by casual riders was 31 minutes and 14 minutes for annual members. The electric bike recorded the lowest ride length at 17 minutes for casuals and 7 minutes for annual members. The docked bike with the highest recorded times at an average of 51 minutes by casual riders and 12 minutes by annual members.

```{r}
all_trips %>% 
  group_by(member_casual, rideable_type) %>%
  summarise(mean = mean(ride_length),
            .groups = "drop") %>%
  arrange(rideable_type)
```
```{r}
all_trips_v2 %>% 
  group_by(member_casual, rideable_type) %>%
  summarise(mean = mean(ride_length),
            .groups = "drop") %>%
  ggplot(aes(rideable_type, mean, fill = member_casual)) +
  geom_col(position = "dodge") +
  labs(title = "Average ride length by bike and user status", 
       y = "Average ride length",
       x = "Bike type")
```

### Docking Station analysis

```{r}
stations<- all_trips_v2 %>%
  gather(key, station_name, start_station_name, end_station_name) %>%
  distinct(station_name)
print(paste("Number of stations are", nrow(stations)))
```
```{r}
users_station <- all_trips_v2 %>%
  gather(key, station_name, start_station_name, end_station_name) %>%
  group_by(member_casual, station_name) %>%
  summarise(no_of_trips = n()/2,
            .groups = "drop_last") %>%
  arrange(desc(no_of_trips)) %>%
  slice(1:10)
```
```{r}
#to check for annual subscribers
users_station %>% 
  tail(10)
```
```{r}
users_station %>%
  tail(10) %>%
  ggplot(aes(no_of_trips, reorder(station_name, no_of_trips))) +
  geom_col() +
  labs(title = "The top 10 most visited stations by member riders", 
       x = "Number of trips", 
       y = "Station name")
```

The data shows that Cyclistic offers 718 stations across Chicago. For the annual members, Clark St & Elm St represents the most used station by with 22,837 trips. Wells St & Concord Ln is the second most utilized station with 17,859 trips, followered by Dearborn St & Erie St with 17,493 trips, Broadway & Barry Ave with 17,398 trips and lastly St. Clair St & Erie St with 17,312 recorded trips.

```{r}
users_station <- all_trips_v2 %>%
  gather(key, station_name, start_station_name, end_station_name) %>%
  group_by(member_casual, station_name) %>%
  summarise(no_of_trips = n()/2,
            .groups = "drop_last") %>%
  arrange(desc(no_of_trips)) %>%
  slice(1:10)
```
```{r}
# for casual riders
users_station %>% 
  head(10)
```
```{r}
users_station %>%
  head(10) %>%
  ggplot(aes(no_of_trips, reorder(station_name, no_of_trips))) +
  geom_col() +
  scale_x_continuous(labels = scales::label_number_si(),
                     breaks = seq(0, 65000, 5000)) +
  labs(title = "The top 10 most visited stations by Casual riders",
       x = "Number of trips",
       y = "Station name")
```

Likewise, the most used station by casual riders is Streeter Dr & Grand Ave with 38,034 recorded trips. It is closely followed by Lake Shore Dr & Monroe St at 27,701, Millennium Park with 25,274 trips and Theater on the Lake with 19,683 recorded trips.

## Conclusions and Recommendations

Lily Moreno is responsible for the development of campaigns and initiatives to promote the bike-share program. With that, I present the following: 

### Conclusions

* The total number of trips were more by annual members although casuals were still in their millions.
* Casual riders had longer trip duration's than annual members.
* Saturday was the best riding day for casual riders and Sunday for annual members.
* Bike use usually peaks at rush hour times, between 3pm to 7pm.
* Months around summer have the most rides by both user categories and winter is the least busiest.
* The most utilized bike are docked bikes with most trips and longer riding duration's.
* Casual riders utilize the bikes more than annual subscribers in all bike categories.
* Clark St & Elm St represents the most used station by members.
* Streeter Dr & Grand Ave is the most used station by casuals.

### Recommendations

The marketing team at Cyclistic understand that users are more likely to ride for leisure, but about 30% use them to commute to work each day. With the flexible pricing plans such as single-ride passes and full-day passes, it will be critical for the company to convert the 41.6% of casual riders to annual members. In order to do that, it is recommended that:

* The marketing team should target casual riders over the weekend during the summer and autumn seasons.
* Approach casual riders at Streeter Dr and Grand Avenue as a start station and Clark St & Elm St as the end station.
* Aim to stock more docked bikes and perhaps promote classic bikes since casual riders ride for longer duration's.
* Include a public health promotion campaign for bike riding benefits.
* Aim to launch the new marketing campaign at peak hours between 3-7pm

